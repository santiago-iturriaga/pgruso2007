<script language="JavaScript" type="text/javascript">

	var http_request = false;
	var request_en_ejecucion = false;
	var request_cantidad = false;
	
	var intervalo;
    function makeRequest(url,handler) {

        request = false;

        if (window.XMLHttpRequest) { // Mozilla, Safari,...
            request = new XMLHttpRequest();
            if (request.overrideMimeType) {
                request.overrideMimeType('text/xml');
                // Ver nota sobre esta linea al final
            }
        } else if (window.ActiveXObject) { // IE
            try {
                request = new ActiveXObject("Msxml2.XMLHTTP");
            } catch (e) {
                try {
                    request = new ActiveXObject("Microsoft.XMLHTTP");
                } catch (e) {}
            }
        }

        if (!request) {
            alert('Falla :( No es posible crear una instancia XMLHTTP');
            return false;
        }
        request.onreadystatechange = handler;
        request.open('GET', url, true);
        request.send(null);
		return request;
    }


    function handlerSalida() {
        if (http_request.readyState == 4) {
            if (http_request.status == 200) {
                document.getElementById('resultados').innerHTML =document.getElementById('resultados').innerHTML+http_request.responseText;
            } else {
                alert('Hubo problemas con la petición:');
            }
        }

    }

    function handlerCantidad() {
        if (request_cantidad.readyState == 4) {
            if (request_cantidad.status == 200) {
                document.getElementById('enejecucion').innerHTML =request_cantidad.responseText;
            } else {
                alert('Hubo problemas con la petición:');
            }
        }

    }


	function handlerEnEjecucion() {
        if (request_en_ejecucion.readyState == 4) {
            if (request_en_ejecucion.status == 200) {
            	if(request_en_ejecucion.responseText != ""){
            		clearInterval(intervalo);
	                alert('La ejecución finalizó correctamente.');
					}
            } else {
                alert('Hubo problemas con la petición:');
            }
        }
    }


	function delay(){ 
	    intervalo = setInterval('cargar()',{SEGUNDOS}000);
	    cargar();
	}
	function cargar(){
		http_request = makeRequest('ajax/getArchivo.php',handlerSalida);
		request_en_ejecucion = makeRequest('ajax/getEnEjecucion.php',handlerEnEjecucion);
		request_cantidad = makeRequest('ajax/getCantEnEjecucion.php',handlerCantidad);
	}

</script>
		<div id="menu_vertical">
			<div id="categories">
				<div id="categories_header">
				<h2>MMMMMM</h2>
				</div>
	
				<ul>
				<li>Usuario: yo</li>
				<li><a href="http://www.freewebsitetemplates.com/">Trabajo: Trabajo1</a></li>
				<<li><a href="logout.php">Desconectarse</a></li>
				<li>Uso del disco: 80%</li>
				<li><a href="alertas.php">Alertas: 0</a></li>
				<li class="last">Trabajos en ejecuci&oacute;n: <span id="enejecucion">{ENEJECUCION}</span></li>
	
				
				</ul>
	
				<div class="clearthis">&nbsp;</div>
			</div>
		</div> 
		<div id="pagina">
			<h1>Resultados de las &uacute;ltimas ejecuciones</h1>
			<pre id="resultados"></pre>
			<a href="descargar.php?id={ID_EJECUCION}&error=0">Descargar salida</a>
			<a href="descargar.php?id={ID_EJECUCION}&error=1">Descargar errores</a>
		</div>
